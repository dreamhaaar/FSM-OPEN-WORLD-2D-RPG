[gd_scene load_steps=84 format=3 uid="uid://c1h7741dwxdb5"]

[ext_resource type="Script" uid="uid://dqxti75ei6u5f" path="res://scripts/enemy.gd" id="1_2r1mg"]
[ext_resource type="Texture2D" uid="uid://et3tlbg2gvu0" path="res://assets/thrust_orc.png" id="2_2r1mg"]
[ext_resource type="Texture2D" uid="uid://buajqobu3bxgl" path="res://assets/idle_orc.png" id="3_ldn8o"]
[ext_resource type="Texture2D" uid="uid://dqimaoiuj83h2" path="res://assets/walk_orc.png" id="4_3i3w8"]
[ext_resource type="Texture2D" uid="uid://bglqlfvse5c2w" path="res://assets/hurt_orc.png" id="5_5kjfs"]
[ext_resource type="Script" uid="uid://dhw1xtffyjtr3" path="res://scripts/finite_state_machine.gd" id="6_e3tm6"]
[ext_resource type="Script" uid="uid://dtro1ab7ntuw5" path="res://scripts/passive_superstate.gd" id="7_pnio7"]
[ext_resource type="Script" uid="uid://d7vphcvleoh7" path="res://scripts/idle_substate.gd" id="8_ybf7j"]
[ext_resource type="Script" uid="uid://cc2i0dnyacwtn" path="res://scripts/wander_substate.gd" id="9_2oc5r"]
[ext_resource type="Script" uid="uid://dck84cluxa1ge" path="res://scripts/aggressive_superstate.gd" id="10_ghymp"]
[ext_resource type="Script" uid="uid://bkxtttgdg2kcx" path="res://scripts/chase_substate.gd" id="11_fqa3v"]
[ext_resource type="Script" uid="uid://ceu0voxoui8s3" path="res://scripts/attack_substate.gd" id="12_igcbf"]
[ext_resource type="Script" uid="uid://dxaxxnxth1b0e" path="res://scripts/scared_superstate.gd" id="13_iyskk"]
[ext_resource type="Script" uid="uid://dbh4dte6dahfx" path="res://scripts/flee_substate.gd" id="14_645nt"]
[ext_resource type="Script" uid="uid://cnriloijx2n2f" path="res://scripts/hurt_substate.gd" id="15_64cga"]
[ext_resource type="Script" uid="uid://cf3sqw48gls84" path="res://scripts/npc_death_state.gd" id="16_7hk0k"]

[sub_resource type="AtlasTexture" id="AtlasTexture_raqv5"]
atlas = ExtResource("2_2r1mg")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_rso78"]
atlas = ExtResource("2_2r1mg")
region = Rect2(64, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_4tfue"]
atlas = ExtResource("2_2r1mg")
region = Rect2(128, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_cjqs3"]
atlas = ExtResource("2_2r1mg")
region = Rect2(192, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_yu442"]
atlas = ExtResource("2_2r1mg")
region = Rect2(256, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_kltx3"]
atlas = ExtResource("2_2r1mg")
region = Rect2(320, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_n4pcg"]
atlas = ExtResource("2_2r1mg")
region = Rect2(384, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_tqo13"]
atlas = ExtResource("2_2r1mg")
region = Rect2(448, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_4r2hw"]
atlas = ExtResource("3_ldn8o")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_81lim"]
atlas = ExtResource("3_ldn8o")
region = Rect2(64, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_m770b"]
atlas = ExtResource("4_3i3w8")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_5i15x"]
atlas = ExtResource("4_3i3w8")
region = Rect2(64, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_qsyu7"]
atlas = ExtResource("4_3i3w8")
region = Rect2(128, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_iwsbt"]
atlas = ExtResource("4_3i3w8")
region = Rect2(192, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_5rwe6"]
atlas = ExtResource("4_3i3w8")
region = Rect2(256, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_rodul"]
atlas = ExtResource("4_3i3w8")
region = Rect2(320, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_e3rbj"]
atlas = ExtResource("4_3i3w8")
region = Rect2(384, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_v64p0"]
atlas = ExtResource("4_3i3w8")
region = Rect2(448, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_8a5gh"]
atlas = ExtResource("4_3i3w8")
region = Rect2(512, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_qp0yf"]
atlas = ExtResource("5_5kjfs")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_bviuh"]
atlas = ExtResource("5_5kjfs")
region = Rect2(64, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_q5uja"]
atlas = ExtResource("5_5kjfs")
region = Rect2(128, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_k1btv"]
atlas = ExtResource("5_5kjfs")
region = Rect2(192, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_17sjt"]
atlas = ExtResource("5_5kjfs")
region = Rect2(256, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_6mo6h"]
atlas = ExtResource("5_5kjfs")
region = Rect2(320, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_0523k"]
atlas = ExtResource("2_2r1mg")
region = Rect2(0, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_voewp"]
atlas = ExtResource("2_2r1mg")
region = Rect2(64, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_0fiik"]
atlas = ExtResource("2_2r1mg")
region = Rect2(128, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_004je"]
atlas = ExtResource("2_2r1mg")
region = Rect2(192, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_2dewh"]
atlas = ExtResource("2_2r1mg")
region = Rect2(256, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_kpe4c"]
atlas = ExtResource("2_2r1mg")
region = Rect2(320, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_80022"]
atlas = ExtResource("2_2r1mg")
region = Rect2(384, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_qgcpw"]
atlas = ExtResource("2_2r1mg")
region = Rect2(448, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_dwlcs"]
atlas = ExtResource("3_ldn8o")
region = Rect2(0, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_t6fah"]
atlas = ExtResource("3_ldn8o")
region = Rect2(64, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_boxqc"]
atlas = ExtResource("4_3i3w8")
region = Rect2(0, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_sn7tm"]
atlas = ExtResource("4_3i3w8")
region = Rect2(64, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_cdsum"]
atlas = ExtResource("4_3i3w8")
region = Rect2(128, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_qttk0"]
atlas = ExtResource("4_3i3w8")
region = Rect2(192, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_npdng"]
atlas = ExtResource("4_3i3w8")
region = Rect2(256, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_110xs"]
atlas = ExtResource("4_3i3w8")
region = Rect2(320, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_hlsrr"]
atlas = ExtResource("4_3i3w8")
region = Rect2(384, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_r4aik"]
atlas = ExtResource("4_3i3w8")
region = Rect2(448, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_idxac"]
atlas = ExtResource("4_3i3w8")
region = Rect2(512, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_uifgu"]
atlas = ExtResource("2_2r1mg")
region = Rect2(0, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_k3ai5"]
atlas = ExtResource("2_2r1mg")
region = Rect2(64, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_bct7m"]
atlas = ExtResource("2_2r1mg")
region = Rect2(128, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_f8wg5"]
atlas = ExtResource("2_2r1mg")
region = Rect2(192, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_7w81j"]
atlas = ExtResource("2_2r1mg")
region = Rect2(256, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_2a3tq"]
atlas = ExtResource("2_2r1mg")
region = Rect2(320, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_lv3rr"]
atlas = ExtResource("2_2r1mg")
region = Rect2(384, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_nm74f"]
atlas = ExtResource("2_2r1mg")
region = Rect2(448, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_f1sy0"]
atlas = ExtResource("3_ldn8o")
region = Rect2(0, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_he21u"]
atlas = ExtResource("3_ldn8o")
region = Rect2(64, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_1jmiy"]
atlas = ExtResource("4_3i3w8")
region = Rect2(0, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_u63h4"]
atlas = ExtResource("4_3i3w8")
region = Rect2(64, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_in1lp"]
atlas = ExtResource("4_3i3w8")
region = Rect2(128, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_4dvim"]
atlas = ExtResource("4_3i3w8")
region = Rect2(192, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_qdcyq"]
atlas = ExtResource("4_3i3w8")
region = Rect2(256, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_81b3g"]
atlas = ExtResource("4_3i3w8")
region = Rect2(320, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_uygjl"]
atlas = ExtResource("4_3i3w8")
region = Rect2(384, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_1cwpg"]
atlas = ExtResource("4_3i3w8")
region = Rect2(448, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_xf5lp"]
atlas = ExtResource("4_3i3w8")
region = Rect2(512, 192, 64, 64)

[sub_resource type="SpriteFrames" id="SpriteFrames_2r1mg"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_raqv5")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_rso78")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4tfue")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cjqs3")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_yu442")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_kltx3")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_n4pcg")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_tqo13")
}],
"loop": true,
"name": &"back_attack",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_4r2hw")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_81lim")
}],
"loop": true,
"name": &"back_idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_m770b")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_5i15x")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_qsyu7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_iwsbt")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_5rwe6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_rodul")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_e3rbj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_v64p0")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_8a5gh")
}],
"loop": true,
"name": &"back_walk",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_qp0yf")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_bviuh")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_q5uja")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_k1btv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_17sjt")
}, {
"duration": 5.0,
"texture": SubResource("AtlasTexture_6mo6h")
}],
"loop": true,
"name": &"die",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_0523k")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_voewp")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_0fiik")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_004je")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2dewh")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_kpe4c")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_80022")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_qgcpw")
}],
"loop": true,
"name": &"front_attack",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_dwlcs")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_t6fah")
}],
"loop": true,
"name": &"front_idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_boxqc")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_sn7tm")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cdsum")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_qttk0")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_npdng")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_110xs")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_hlsrr")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_r4aik")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_idxac")
}],
"loop": true,
"name": &"front_walk",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_uifgu")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_k3ai5")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_bct7m")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_f8wg5")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_7w81j")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2a3tq")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_lv3rr")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_nm74f")
}],
"loop": true,
"name": &"side_attack",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_f1sy0")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_he21u")
}],
"loop": true,
"name": &"side_idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_1jmiy")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_u63h4")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_in1lp")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4dvim")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_qdcyq")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_81b3g")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_uygjl")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_1cwpg")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_xf5lp")
}],
"loop": true,
"name": &"side_walk",
"speed": 10.0
}]

[sub_resource type="CircleShape2D" id="CircleShape2D_qaulx"]
radius = 178.53851

[sub_resource type="CircleShape2D" id="CircleShape2D_c4w8v"]
radius = 16.0

[sub_resource type="CircleShape2D" id="CircleShape2D_5uy6h"]
radius = 45.276924

[node name="goblin" type="CharacterBody2D"]
collision_layer = 4
collision_mask = 3
motion_mode = 1
script = ExtResource("1_2r1mg")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
position = Vector2(0, -1.54)
scale = Vector2(0.71874994, 0.766875)
sprite_frames = SubResource("SpriteFrames_2r1mg")
animation = &"side_walk"

[node name="detection" type="Area2D" parent="."]
collision_layer = 0
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="detection"]
shape = SubResource("CircleShape2D_qaulx")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("CircleShape2D_c4w8v")

[node name="enemy_hitbox" type="Area2D" parent="."]
collision_mask = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="enemy_hitbox"]
position = Vector2(2, 4)
shape = SubResource("CircleShape2D_5uy6h")

[node name="take_damage_cooldown" type="Timer" parent="."]
wait_time = 0.5

[node name="regen_cooldown" type="Timer" parent="."]

[node name="enemy_healthbar" type="ProgressBar" parent="."]
modulate = Color(0.39607844, 0, 0.39607844, 1)
offset_left = -13.0
offset_top = -26.0
offset_right = 63.666664
offset_bottom = -6.0
scale = Vector2(0.3, 0.3)
show_percentage = false

[node name="Timer" type="Timer" parent="."]

[node name="HFSM" type="Node" parent="."]
script = ExtResource("6_e3tm6")

[node name="Passive" type="Node" parent="HFSM" node_paths=PackedStringArray("sub_fsm")]
script = ExtResource("7_pnio7")
sub_fsm = NodePath("PassiveSM")

[node name="PassiveSM" type="Node" parent="HFSM/Passive"]
script = ExtResource("6_e3tm6")

[node name="Idle" type="Node" parent="HFSM/Passive/PassiveSM"]
script = ExtResource("8_ybf7j")

[node name="Wander" type="Node" parent="HFSM/Passive/PassiveSM"]
script = ExtResource("9_2oc5r")

[node name="Aggressive" type="Node" parent="HFSM" node_paths=PackedStringArray("sub_fsm")]
script = ExtResource("10_ghymp")
sub_fsm = NodePath("AggressiveSM")

[node name="AggressiveSM" type="Node" parent="HFSM/Aggressive"]
script = ExtResource("6_e3tm6")

[node name="Chase" type="Node" parent="HFSM/Aggressive/AggressiveSM"]
script = ExtResource("11_fqa3v")

[node name="Attack" type="Node" parent="HFSM/Aggressive/AggressiveSM"]
script = ExtResource("12_igcbf")

[node name="Scared" type="Node" parent="HFSM" node_paths=PackedStringArray("sub_fsm")]
script = ExtResource("13_iyskk")
sub_fsm = NodePath("ScaredSM")

[node name="ScaredSM" type="Node" parent="HFSM/Scared"]
script = ExtResource("6_e3tm6")

[node name="Flee" type="Node" parent="HFSM/Scared/ScaredSM"]
script = ExtResource("14_645nt")

[node name="Hurt" type="Node" parent="HFSM"]
script = ExtResource("15_64cga")

[node name="Death" type="Node" parent="HFSM"]
script = ExtResource("16_7hk0k")

[connection signal="body_entered" from="detection" to="." method="_on_detection_body_entered"]
[connection signal="body_exited" from="detection" to="." method="_on_detection_body_exited"]
[connection signal="body_entered" from="enemy_hitbox" to="." method="_on_enemy_hitbox_body_entered"]
[connection signal="body_exited" from="enemy_hitbox" to="." method="_on_enemy_hitbox_body_exited"]
[connection signal="timeout" from="take_damage_cooldown" to="." method="_on_take_damage_cooldown_timeout"]
[connection signal="timeout" from="regen_cooldown" to="." method="_on_regen_cooldown_timeout"]
